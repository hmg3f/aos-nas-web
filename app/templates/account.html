{% extends "base.html" %}

{% block page_title %}Account Manager{% endblock %}

{% block content %}
<section id="account-manager" class="panel">
  <h1>Account Management</h1>

  <form method="POST" action="{{ url_for('/auth.account_manager') }}">
    {{ form.hidden_tag() }}
    
    <div class="form-group">
      <label for="username">Username</label>
      {{ form.username(class="form-control", value=current_user.username) }}
    </div>

    <div class="form-group">
      <label for="current_password">Current Password</label>
      {{ form.current_password(class="form-control") }}
    </div>

    <div class="form-group">
      <label for="new_password">New Password</label>
      {{ form.new_password(class="form-control") }}
    </div>

    <div class="form-group">
      <label for="confirm_password">Confirm New Password</label>
      {{ form.confirm_password(class="form-control") }}
    </div>

    <div class="form-group">
      <button type="submit">Update Account</button>
    </div>
  </form>
  
  <div class="controls">
    <a href="{{url_for('/store.file_viewer')}}">â—€ Return</a>
    <a href="{{url_for('/auth.logout')}}">Log Out</a>
    {% if not current_user.has_flag(1) %}
    <a href="{{url_for('/auth.disable_current_user')}}">Delete Account</a>
    {% endif %}
  </div>

  {% if current_user.has_flag(1) %}
  <section class="admin-controls subpanel">
    <h2>Other Users:</h2>
    <table style="width: 100%;">
      <tbody>
	{% for user in users_list %}
	<tr>
	  <td>{{ user.username }}</td>
	  <td style="width: 0;">
	    <a href="{{ url_for('/auth.delete_user', userid=user.id) }}">
	      <button class="delete-user-button">Delete</button>
	    </a>
	  </td>
	  <td style="width: 0;">
	    {% if user.enabled %}
	    <a href="{{ url_for('/auth.disable_user', userid=user.id) }}">
	      <button class="disable-user-button">Disable</button>
	    </a>
	    {% else %}
	    <a href="{{ url_for('/auth.enable_user', userid=user.id) }}">
	      <button class="enable-user-button">Enable</button>
	    </a>
	    {% endif %}
	  </td>
	</tr>
	{% endfor %}
      </tbody>
    </table>
  </section>
  {% endif %}
</section>
{% endblock %}
