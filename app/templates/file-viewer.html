{% extends "base.html" %}

{% block page_title %}File Viewer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/diff.css') }}">
{% endblock %}

{% block preload_scripts %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
{% endblock %}

{% block content %}
<section id="file-view" class="panel">
  <h1>Files</h1>

  <table>
    <thead>
      <tr>
	<th>
          <input type="checkbox" id="select-all">
	  <img src="{{ url_for('static', filename='asset/trash-can.svg') }}" alt="Delete" width="15px" height="15px">
        </th>
	<th style="width: 70%;">Name</th>
	<th>Owner</th>
	<th>Group</th>
	<th>Size</th>
	<th>Permissions</th>
      </tr>
    </thead>
    <tbody>
      {% for name, owner, group, size, permissions in file_list %}
      <tr>
	<td>
	  <input type="checkbox" class="file-checkbox" data-filename="{{ name }}">
	</td>
	<td>
	  <a href="" class="overflow-hidden">
	    {{ name }}
	  </a>
	</td>
	<td>{{ owner }}</td>
	<td>{{ group }}</td>
	<td>{{ size }}</td>
	<td>{{ permissions }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<section id="toolbox" class="panel">
  <h1>Toolbox</h1>
  
  <div class="controls">
    <a href="{{url_for('logout')}}">◀ Logout</a>
    <button id="delete-button" disabled>Delete Selected</button>
  </div>

  <section id="file-upload" class="subpanel">
    <h2>Upload File</h2>
    <form method="POST" id="upload-form" action="{{ url_for('/store.add_file') }}" enctype="multipart/form-data">
      <div class="form-group">
        <label for="file-input">Choose file:</label>
        <input type="file" name="file" required>
      </div>

      <div class="form-group">
        <label>Permissions:</label>
        <div class="permissions-grid">
          <div class="perm-header"></div>
          <div class="perm-header">User</div>
          <div class="perm-header">Group</div>
          <div class="perm-header">Everyone</div>
          
          <div class="perm-label">Read</div>
          <input type="checkbox" name="perm_user_read" checked>
          <input type="checkbox" name="perm_group_read" checked>
          <input type="checkbox" name="perm_everyone_read">
          
          <div class="perm-label">Write</div>
          <input type="checkbox" name="perm_user_write" checked>
          <input type="checkbox" name="perm_group_write">
          <input type="checkbox" name="perm_everyone_write">
          
          <div class="perm-label">Execute</div>
          <input type="checkbox" name="perm_user_execute" checked>
          <input type="checkbox" name="perm_group_execute">
	  <input type="checkbox" name="perm_everyone_execute">
	</div>
	
	<div class="permission-display">
	  Octal: <span id="octal-display">740</span>
	</div>
	
	<button type="submit">Upload</button>
      </div>
      
      <div id="upload-status"></div>
    </form>
  </section>

  <section id="archive-manager" class="subpanel">
    <h2>Archive Manager</h2>

    <div class="selector">
      <button id="previous-archive" class="archive-nav" disabled>◀</button>
      <select id="archive-selector">
	{% for archive in archive_list %}
	<option value="{{ archive['id'] }}">{{ archive['name'] }}</option>
	{% endfor %}
	<option value="" disabled selected>select previous archive...</option>
      </select>
      <button id="next-archive" class="archive-nav">▶</button>
    </div>

    <div id="diff-panel">
      <h3>Diff View</h3>
      <div id="diff-viewer"></div>
    </div>
    
    <button id="revert-archive" disabled>Revert to Archive</button>
  </section>
</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/upload-handler.js') }}"></script>
<script src="{{ url_for('static', filename='js/file-delete.js') }}"></script>
<script src="{{ url_for('static', filename='js/archive-select.js') }}"></script>
{% endblock %}
